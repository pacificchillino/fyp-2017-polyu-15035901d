<div class="panel panel-default">
	<div class="panel-heading"><b>Search for Raw Data</b></div>
	<div class="panel-body">
		<form>
			<div class="form-group">
				<div class="row">
					<%# Section selector %>
					<label class="control-label col-sm-3 col-lg-2" for="section">Select section:</label>
					<div class="col-sm-9 col-lg-4">
						<select class="form-control" id="section">
							<option value="">-- Please select --</option>
							<% for (var i in searchbox.sections){ %>
							<% var selected = (params.stopA+"/"+params.stopB == searchbox.sections[i].from_to) ? " selected" : ""; %>
							<option value = "<%= searchbox.sections[i].from_to %>"<%= selected %>><%= searchbox.sections[i].caption %></option>
							<% } %>
						</select>
					</div>
					<%# Sorting %>
					<label class="control-label col-sm-3 col-lg-2" for="sort">Sort from:</label>
					<div class="col-sm-9 col-lg-4">
						<select class="form-control" id="sort">
							<option value="">No sorting</option>
							<% for (var i in searchbox.sortby){ %>
							<% var selected = (query.sortby == i) ? " selected" : ""; %>
							<option value = "<%= i %>"<%= selected %>><%= searchbox.sortby[i].name %></option>
							<% } %>
						</select>
					</div>
				</div>
				<div class="row">
					<%# Filter: Weekdays? %>
					<label class="control-label col-sm-3 col-lg-2" for="wkday">-Weekdays?</label>
					<div class="col-sm-9 col-lg-4">
						<select class="form-control" id="wkday">
							<option value="">Not filtered</option>
							<% var selected = (query.wkday == 1) ? " selected" : ""; %>
							<option value="1"<%= selected %>>Weekdays only</option>
							<% var selected = (query.wkday == 0) ? " selected" : ""; %>
							<option value="0"<%= selected %>>Non-weekdays only</option>
						</select>
					</div>
					<%# Filter: DOW %>
					<label class="control-label col-sm-3 col-lg-2" for="dow">-Day of the Week?</label>
					<div class="col-sm-9 col-lg-4">
						<select class="form-control" id="dow">
							<option value="">Not filtered</option>
							<% var selected = (query.dow == 0) ? " selected" : ""; %>
							<option value="0"<%= selected %>>Sundays</option>
							<% var selected = (query.dow == 1) ? " selected" : ""; %>
							<option value="1"<%= selected %>>Mondays</option>
							<% var selected = (query.dow == 2) ? " selected" : ""; %>
							<option value="2"<%= selected %>>Tuesdays</option>
							<% var selected = (query.dow == 3) ? " selected" : ""; %>
							<option value="3"<%= selected %>>Wednesdays</option>
							<% var selected = (query.dow == 4) ? " selected" : ""; %>
							<option value="4"<%= selected %>>Thursdays</option>
							<% var selected = (query.dow == 5) ? " selected" : ""; %>
							<option value="5"<%= selected %>>Fridays</option>
							<% var selected = (query.dow == 6) ? " selected" : ""; %>
							<option value="6"<%= selected %>>Saturdays</option>
						</select>
					</div>
					<%# Filter: Date %>
					<label class="control-label col-sm-3 col-lg-2" for="date_gt">-Date (from ..)</label>
					<div class="col-sm-9 col-lg-4">
							<input type="text" class="datepicker form-control" id="date_gt" placeholder="Not filtered">
					</div>
					<label class="control-label col-sm-3 col-lg-2" for="date_lt">-Date (.. to)</label>
					<div class="col-sm-9 col-lg-4">
							<input type="text" class="datepicker form-control" id="date_lt" placeholder="Not filtered">
					</div>
					<%# Filter: Time %>
					<label class="control-label col-sm-3 col-lg-2" for="time_gt">-Time (from ..)</label>
					<div class="col-sm-9 col-lg-4">
							<input type="text" class="timepicker form-control" id="time_gt" placeholder="Not filtered">
					</div>
					<label class="control-label col-sm-3 col-lg-2" for="time_lt">-Time (.. to)</label>
					<div class="col-sm-9 col-lg-4">
							<input type="text" class="timepicker form-control" id="time_lt" placeholder="Not filtered">
					</div>
				</div>
				<div class="row">
					<br/>
					<button type="button" class="btn-block btn-default" onclick="searchbox_submit();">Search</button>
				</div>
			</div>
		</form>
	</div>
</div>

<script language = "javascript">
	//Date & Time Pickers
	$('.datepicker').pickadate({format: 'yyyy/mm/dd'});
	$('.timepicker').pickatime({format: 'HH:i'});
	//Submit
	function searchbox_submit(){
		if ($("#section").val() != ""){
			//Valid
			var URL = "/trams/data/" + $("#section").val();
			var params = [];
			if ($("#sort").val() != "") params.push("sortby=" + $("#sort").val());
			if ($("#wkday").val() != "") params.push("wkday=" + $("#wkday").val());
			if ($("#dow").val() != "") params.push("dow=" + $("#dow").val());
			if ($("#date_gt").val() != "") params.push("date_gt=" + $("#date_gt").val());
			if ($("#date_lt").val() != "") params.push("date_lt=" + $("#date_lt").val());
			if ($("#time_gt").val() != "") params.push("hours_gt=" + $("#time_gt").val());
			if ($("#time_lt").val() != "") params.push("hours_lt=" + $("#time_lt").val());
			//Concat URL
			if (params.length) URL += "?" + params.join("&");
			//Go to new URL
			window.location.href = URL;
		}
	}
	//Prefill data
	<% if(query.date_gt != null){ %> $("#date_gt").val("<%= query.date_gt %>"); <% } %>
	<% if(query.date_lt != null){ %> $("#date_lt").val("<%= query.date_lt %>"); <% } %>
	<% if(query.hours_gt != null){ %> $("#time_gt").val("<%= query.hours_gt %>"); <% } %>
	<% if(query.hours_lt != null){ %> $("#time_lt").val("<%= query.hours_lt %>"); <% } %>
</script>